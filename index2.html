<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="indexstyle.css">
    </head>
    <header>
        <h1>Connect 4</h1>
    </header>
    <body>
        <section>
            <h1 id="user"></h1>
        </section>
        <section>
            <button><a href="game.html">Play</button>
            <button><a href="help.html">Help</button>
            <button><a href="leaderboard.html">LeaderBoard</button>
            <button><a href="contact.html">Contact</button>
            <p>
                <button><a href="login.html">Login</button>
                <button><a href="logout_mysql.php">Logout</button>
            </p>
        </section>
    </body>

    <script>
        var user = "";
        var params = "";
        var xhr;

        function getUser(){
            //console.log("trying getUser <br>");
            params = "?username=set";

            xhr = new XMLHttpRequest
            xhr.open("GET", "check_connection.php" + params);
            
            xhr.onreadystatechange = setUser;
            xhr.send();
        }

        document.addEventListener("DOMContentLoaded", ()=>{
            //console.log("Inside event listener <br>");
            getUser();
        })

        function goodRequest(){
            return xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200;
        }

        function setUser(){
            if(goodRequest()){
                //console.log("request is good");
                user = xhr.response; //gets username from echo in check_login.php
                console.log(user);
                document.getElementById("user").innerText = "Welcome "+user;
            }
            else if(xhr.status == 401){
                window.location.replace("logout_mysql.php");
            }
        }

    </script>
</html>